<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title> Github 的中最流行 JavaScript 项目</title>
    <link type="image/x-icon" rel="shortcut icon" href="https://avatars3.githubusercontent.com/u/4074517?v=3&s=40" />
    <link rel="stylesheet" href="./styles/main.css">
    <script src="./js/react.js"></script>
    <script src="./js/react-dom.js"></script>
    <script src="./js/browser.min.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/main.js"></script>
    <base href="https://api.github.com/" target="preview_page" />
  </head>
  <body>
    <div id="tabbed_box_1" class="tabbed_box">
      <h1>Github 中最流行的 JavaScript 项目
        <small>React 示例</small>
      </h1>
      <div class="tabbed_area">
        <ol class="tabs">
          <li><a title="stars" class="tab active">Most Stars</a></li>
          <li><a title="forks" class="tab">Most Forks</a></li>
        </ol>
        <div style="display: block;" id="stars" class="content"></div>
        <div style="display: block;" id="forks" class="content"></div>
      </div>
    </div>
    <script type="text/babel">
      var RepoStarsList = React.createClass({
        getInitialState: function(){
          return {
            loading: true,
            error: null,
            data: null
          };
        },

        componentDidMount(){
          this.props.promise.then(
            value=> this.setState({loading: false, data: value}),
            error=> this.setState({loading: false, error: error})
          );
        },

        render: function(){
          if(this.state.loading){
            return <span>Loading...</span>
          } else if(this.state.error !== null){
            return <span>Error: {this.state.error.message}</span>;
          } else {
            var repos = this.state.data.items;
            var repoList = repos.map(function(repo){
              return (
                <li>
                  <a href={repo.html_url}>{repo.full_name}
                    <small>({repo.stargazers_count} stars, {repo.forks_count} forks)</small>
                    <br/>
                    <small>{repo.description}</small>
                  </a>
                </li>
              );
            });
            return (
              <ol>{repoList}</ol>
            );
          }
        }
      });

      ReactDOM.render(
        <RepoStarsList promise={$.getJSON("search/repositories?q=javascript&sort=stars")} />,
        document.getElementById("stars")
      );

      var RepoForksList = React.createClass({
        getInitialState: function(){
          return {
            loading: true,
            error: null,
            data: null
          };
        },

        componentDidMount(){
          this.props.promise.then(
            value=> this.setState({loading: false, data: value}),
            error=> this.setState({loading: false, error: error})
          );
        },

        render: function(){
          if(this.state.loading){
            return <span></span>
          } else if(this.state.error !== null){
            return <span>Error: {this.state.error.message}</span>;
          } else {
            var repos = this.state.data.items;
            var repoList = repos.map(function(repo){
              return (
                <li>
                  <a href={repo.html_url}>{repo.full_name}
                    <small>({repo.forks_count} forks, {repo.stargazers_count} stars)</small>
                    <br/>
                    <small>{repo.description}</small>
                  </a>
                </li>
              );
            });
            return (
              <ol>{repoList}</ol>
            );
          }
        }
      });

      ReactDOM.render(
        <RepoForksList promise={$.getJSON("search/repositories?q=javascript&sort=forks")} />,
        document.getElementById("forks")
      );
    </script>
  </body>
</html>
